{% extends "base.html" %}
{% set page_title = "Status Board" %}
{% set active_page = "status_board" %}
{% block title %}Clavis | Status Board{% endblock %}

{% block content %}
<div class="space-y-6">
  <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.16em] text-slate-400">Global Operations</p>
        <h2 class="text-2xl font-semibold text-slate-800">Hospital Workflow Overview</h2>
      </div>
      <div class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-slate-50 p-1">
        <button class="rounded-lg bg-white px-3 py-1.5 text-xs font-semibold text-slate-700 shadow-sm">Live</button>
        <button class="rounded-lg px-3 py-1.5 text-xs font-semibold text-slate-500 hover:bg-white">Last 24h</button>
        <button class="rounded-lg px-3 py-1.5 text-xs font-semibold text-slate-500 hover:bg-white">Last 7d</button>
      </div>
    </div>
  </section>

  <section class="grid gap-4 sm:grid-cols-2 xl:grid-cols-4">
    {% set card_label = 'Total Active Cases' %}
    {% set card_value = status_totals.active if status_totals is defined and status_totals.active is defined else '342' %}
    {% set card_trend = '+14' %}
    {% set card_trend_tone = 'positive' %}
    {% set card_subtitle = 'Across all departments' %}
    {% set card_tone = 'indigo' %}
    {% include 'components/card.html' %}

    {% set card_label = 'Critical Watch' %}
    {% set card_value = status_totals.critical if status_totals is defined and status_totals.critical is defined else '19' %}
    {% set card_trend = '6 escalations' %}
    {% set card_trend_tone = 'negative' %}
    {% set card_subtitle = 'Immediate follow-up required' %}
    {% set card_tone = 'rose' %}
    {% include 'components/card.html' %}

    {% set card_label = 'Pending Transitions' %}
    {% set card_value = status_totals.pending if status_totals is defined and status_totals.pending is defined else '88' %}
    {% set card_trend = '+9 in 30m' %}
    {% set card_trend_tone = 'negative' %}
    {% set card_subtitle = 'Awaiting next workflow state' %}
    {% set card_tone = 'amber' %}
    {% include 'components/card.html' %}

    {% set card_label = 'Completed Today' %}
    {% set card_value = status_totals.completed if status_totals is defined and status_totals.completed is defined else '1,024' %}
    {% set card_trend = '+11.2%' %}
    {% set card_trend_tone = 'positive' %}
    {% set card_subtitle = 'Resolved clinical actions' %}
    {% set card_tone = 'emerald' %}
    {% include 'components/card.html' %}
  </section>

  <section class="grid gap-6 xl:grid-cols-12">
    <article class="xl:col-span-8 rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.14em] text-slate-400">Department Panels</p>
          <h3 class="text-lg font-semibold text-slate-800">Live Queue Snapshot</h3>
        </div>
      </div>

      <div class="mt-5 grid gap-4 md:grid-cols-2">
        {% if department_panels is defined and department_panels %}
          {% for panel in department_panels %}
            <div class="rounded-2xl border border-slate-200 p-4">
              <div class="flex items-center justify-between">
                <p class="text-sm font-semibold text-slate-700">{{ panel.name }}</p>
                {% set badge_text = panel.health|default('Stable') %}
                {% if badge_text|lower in ['critical', 'overloaded'] %}
                  {% set badge_tone = 'rose' %}
                {% elif badge_text|lower in ['busy', 'watch'] %}
                  {% set badge_tone = 'amber' %}
                {% else %}
                  {% set badge_tone = 'emerald' %}
                {% endif %}
                {% include 'components/badge.html' %}
              </div>
              <div class="mt-4 grid grid-cols-3 gap-2 text-center">
                <div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Queued</p><p class="text-sm font-semibold text-slate-700">{{ panel.queued }}</p></div>
                <div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">In Progress</p><p class="text-sm font-semibold text-slate-700">{{ panel.active }}</p></div>
                <div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Overdue</p><p class="text-sm font-semibold text-slate-700">{{ panel.overdue }}</p></div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="rounded-2xl border border-slate-200 p-4">
            <div class="flex items-center justify-between"><p class="text-sm font-semibold text-slate-700">Emergency</p>{% set badge_text = 'Busy' %}{% set badge_tone = 'amber' %}{% include 'components/badge.html' %}</div>
            <div class="mt-4 grid grid-cols-3 gap-2 text-center"><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Queued</p><p class="text-sm font-semibold text-slate-700">31</p></div><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">In Progress</p><p class="text-sm font-semibold text-slate-700">22</p></div><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Overdue</p><p class="text-sm font-semibold text-slate-700">5</p></div></div>
          </div>
          <div class="rounded-2xl border border-slate-200 p-4">
            <div class="flex items-center justify-between"><p class="text-sm font-semibold text-slate-700">Radiology</p>{% set badge_text = 'Stable' %}{% set badge_tone = 'emerald' %}{% include 'components/badge.html' %}</div>
            <div class="mt-4 grid grid-cols-3 gap-2 text-center"><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Queued</p><p class="text-sm font-semibold text-slate-700">14</p></div><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">In Progress</p><p class="text-sm font-semibold text-slate-700">18</p></div><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Overdue</p><p class="text-sm font-semibold text-slate-700">1</p></div></div>
          </div>
          <div class="rounded-2xl border border-slate-200 p-4">
            <div class="flex items-center justify-between"><p class="text-sm font-semibold text-slate-700">Laboratory</p>{% set badge_text = 'Watch' %}{% set badge_tone = 'amber' %}{% include 'components/badge.html' %}</div>
            <div class="mt-4 grid grid-cols-3 gap-2 text-center"><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Queued</p><p class="text-sm font-semibold text-slate-700">27</p></div><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">In Progress</p><p class="text-sm font-semibold text-slate-700">24</p></div><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Overdue</p><p class="text-sm font-semibold text-slate-700">4</p></div></div>
          </div>
          <div class="rounded-2xl border border-slate-200 p-4">
            <div class="flex items-center justify-between"><p class="text-sm font-semibold text-slate-700">Pharmacy</p>{% set badge_text = 'Stable' %}{% set badge_tone = 'emerald' %}{% include 'components/badge.html' %}</div>
            <div class="mt-4 grid grid-cols-3 gap-2 text-center"><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Queued</p><p class="text-sm font-semibold text-slate-700">16</p></div><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">In Progress</p><p class="text-sm font-semibold text-slate-700">20</p></div><div class="rounded-xl bg-slate-50 p-2"><p class="text-xs text-slate-500">Overdue</p><p class="text-sm font-semibold text-slate-700">2</p></div></div>
          </div>
        {% endif %}
      </div>
    </article>

    <article class="xl:col-span-4 rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <p class="text-xs font-semibold uppercase tracking-[0.14em] text-slate-400">Escalation Feed</p>
      <h3 class="text-lg font-semibold text-slate-800">High Priority Updates</h3>
      <div class="mt-5 space-y-3">
        <div class="rounded-xl border border-rose-200 bg-rose-50 p-3">
          <p class="text-sm font-semibold text-rose-700">CT delay for patient MRN-10244</p>
          <p class="mt-1 text-xs text-rose-600">Radiology queue exceeded SLA by 6 minutes.</p>
        </div>
        <div class="rounded-xl border border-amber-200 bg-amber-50 p-3">
          <p class="text-sm font-semibold text-amber-700">Lab capacity warning</p>
          <p class="mt-1 text-xs text-amber-600">Blood panel backlog increasing in block B.</p>
        </div>
        <div class="rounded-xl border border-indigo-200 bg-indigo-50 p-3">
          <p class="text-sm font-semibold text-indigo-700">Transfer coordination active</p>
          <p class="mt-1 text-xs text-indigo-600">4 cardiology handoffs queued for review.</p>
        </div>
      </div>
      <button class="mt-5 w-full rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-indigo-700">Open Incident Room</button>
    </article>
  </section>
</div>
{% endblock %}
