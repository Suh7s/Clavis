{% extends "base.html" %}
{% block title %}Clavis â€” Patients{% endblock %}
{% block content %}
<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold text-gray-800">Patients</h1>
  <button onclick="document.getElementById('newPatientModal').classList.toggle('hidden')"
    class="bg-blue-600 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-700">
    + New Patient
  </button>
</div>

<div id="newPatientModal" class="hidden mb-6 bg-white rounded-lg border p-4">
  <h3 class="font-semibold text-gray-700 mb-3">Register Patient</h3>
  <form onsubmit="createPatient(event)" class="flex gap-3 items-end">
    <div>
      <label class="block text-xs text-gray-500 mb-1">Name</label>
      <input id="pName" required class="border rounded px-3 py-1.5 text-sm" placeholder="Full name">
    </div>
    <div>
      <label class="block text-xs text-gray-500 mb-1">Age</label>
      <input id="pAge" type="number" required class="border rounded px-3 py-1.5 text-sm w-20" placeholder="Age">
    </div>
    <div>
      <label class="block text-xs text-gray-500 mb-1">Gender</label>
      <select id="pGender" class="border rounded px-3 py-1.5 text-sm">
        <option>Male</option><option>Female</option><option>Other</option>
      </select>
    </div>
    <button type="submit" class="bg-green-600 text-white text-sm px-4 py-1.5 rounded hover:bg-green-700">Create</button>
  </form>
</div>

<div id="patientList" class="space-y-2"></div>

<script>
async function loadPatients() {
  const res = await fetch('/patients');
  const patients = await res.json();
  const el = document.getElementById('patientList');
  if (patients.length === 0) {
    el.innerHTML = '<p class="text-gray-500 text-sm">No patients registered.</p>';
    return;
  }
  el.innerHTML = patients.map(p => `
    <a href="/patients/${p.id}/view"
       class="block bg-white border rounded-lg px-5 py-4 hover:border-blue-400 hover:shadow-sm transition">
      <div class="flex items-center justify-between">
        <div>
          <span class="font-semibold text-gray-800">${p.name}</span>
          <span class="ml-3 text-sm text-gray-500">${p.age}y, ${p.gender}</span>
        </div>
        <span class="text-xs text-gray-400">ID #${p.id}</span>
      </div>
    </a>
  `).join('');
}

async function createPatient(e) {
  e.preventDefault();
  await fetch('/patients', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      name: document.getElementById('pName').value,
      age: parseInt(document.getElementById('pAge').value),
      gender: document.getElementById('pGender').value
    })
  });
  document.getElementById('pName').value = '';
  document.getElementById('pAge').value = '';
  document.getElementById('newPatientModal').classList.add('hidden');
  loadPatients();
}

loadPatients();
</script>
{% endblock %}
